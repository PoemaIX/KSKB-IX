# What is Virtual IXP

在了解什麼是虛擬IXP以前，先了解什麼是「網」吧!  
這裡的網，是指大家平常上網的網   
我一開始是因為興趣，接入了 DN42 網，後來取得真實 ASN  
我們把真正幫我們傳遞封包的稱作「專業ISP」，我這種業餘的叫做「Player」吧  
講的可能有誤，歡迎糾錯

## 專業ISP
真正的 ISP 的網，大概像這樣子  
![](https://i.imgur.com/EUixT9N.png)  
有著自己的的眾多節點，提供著各式各樣的服務  
個個節點和資料中心之間，使用物理電路/光纜線相連  
並且給客戶提供服務時，也是真的拉一條線去那邊(比如物理上拉了一條線到你家，讓你上網)  

## 業餘 Player
至於業餘的網，大概長這樣子  
有許多節點，但幾乎都是VM，或是租用別人的基礎設施  
VM之間也沒有自己的基礎光纖設施，而是**使用隧道來「模擬」光纜**，使節點間互聯  
![](https://i.imgur.com/ukRolkU.png)  

## 網路互連
每家業者都有自己的眾多節點，節點之間互相拉光纖來傳輸流量  
但是，不同業者之間，也需要交換流量。這就是「互連」  
中華電信有自己的網，遠傳電信也有自己的網。  
但是在中華電信和遠傳之間，各有一個(可能有多個)節點是**戶相連起來**的這就是「互聯」  
每當中華電信的使用者，想要連線遠傳的網站時，就要經過這這個互連點   
![](https://i.imgur.com/xC9vlU5.png)  
互連點之間，也是透過光纖連接  
因為這條光纖同時連接兩家業者，所以可能會拆帳，比如建設費用你付一半我付一半之類  

## IXP: 網路交換中心
但是這個時候，就會遇到問題了  
現在業者越來越多了，但是每家業者之間都要兩兩互連  
就會像這樣子，要蓋的光纜線越來越多了，呈現指數上漲  
![](https://i.imgur.com/TYyAiNt.png)  
於是，就有了「網路交換中心(IXP)」的概念出現了  
只要像這樣，大家都連線到交換中心，就可以和其他 ISP 互連了  
![](https://i.imgur.com/iH6Nm5w.png)  

## 物理 IXP
而物理 IXP 就是**真的有光纜**  

每家業者都有著眾多的節點，甚至有著自己的資料中心，提供各式各樣的服務  
但是現在業者間不用互相喬攏，誰蓋光纖線誰出錢  
只要大家一起挖馬路，從自己的節點蓋光纖到交換中心就好了  
大家一起把網路線插到 IXP 的交換機上面，然後交換路由和流量(也就是跳線接入)  
或是 IXP colo ，把自己的路由器直接放在 IXP 的機櫃裡面  
然後搭配「進線服務」，把自己的外部連點和自己放在 IXP 機櫃的路由器，物理上面連接起來  
![](https://i.imgur.com/0HXWiAX.png)  

「進線服務」是指 colo 了以後，雖然在 IXP 內有了節點。但是**光有 IXP 內孤立的節點也沒用**  
還是**要有光纜線連起自己和其他節點之間**才行，這樣才能將自己的業務流量送入 IXP 裡面交換  
進線服務，就提供了解決方案。他能幫忙你連接起 IXP 內的節點和自己的外部節點  

進線服務和 IXP 自身幾乎同等重要。[這篇文章](https://www.ptt.cc/bbs/Broad_Band/M.1239365152.A.886.html) 就吐槽了中華電信一直死守 TWIX 不讓其它人進線  
連進 IXP LAN 的成本比直接蓋互連光纜還要高出 N 倍，也為台灣的畸形的網路環境推了一把(最近稍微好了一點，但還是遠遠比不上香港/新加坡/日本)  
如果有一個 IX 不管是把封包送進去，還是把封包送出來都難如登天。那也沒什麼人願意在這邊交換了  

順帶一提「port接入、colo、跳線、進線」 分別是獨立不相干服務，甚至可能由不同提供商提供  

以 STUIX 為例  
STUIX 提供了「port 接入」、「colo」服務  
是方電訊提供了「跳線」、「進線」和「colo」服務  
要互相搭配，才能組出優質的網路  

## 虛擬 IXP

虛擬 IXP 則是類似這樣，主要是「模擬」物理 IXP，讓業餘愛好者體驗接入 IXP 的感覺  
![](https://i.imgur.com/jt1pPjI.png)  

1. 隧道接入: 模擬外部跳線接入。直接從自己外部的路由器連接到 IX 的交換機上
2. VM 接入: 
    1. VM本體: 模擬 IXP colo 接入，把自己的機器部屬在 IXP 裡面
    2. Underlay 網路: 模擬 colo 的外部進線服務，讓大家打隧道去自己其他的內網節點。通常被稱作「上網卡」

虛擬 IX 和物理 IX 類似，也有**模擬**出跳線/進線的部分。這部分就受限於上層的網路品質了，但是選擇也多了起來  

比如從 KSKB-IX 連出時，乘載網有「中華電信直連」、「WARP VPN(cloudflare)」、「大易網(再次感謝小易)」三條線路選擇  
如果大家的節點到 KSKB-IX 都有著 100ms 的延遲，那也意味著只要在這邊交換的流量都會有 200ms 的基礎延遲  
只有當大家的封包能都盡快抵達自己的其他節點，在 KSKB-IX 交換才能有盡量好的表現  
但是這也不改變 KSKB-IX 是虛擬 IX 的本質。物理上還是依托於中華電信的電路。只能做為實驗使用  

## 混合 IXP

還有一種IX: 混和IX。就是類似這種，混和了虛擬IX和實體IX，開放物理接入的同時允許業餘玩家用隧道/VM的方式接入  
![](https://i.imgur.com/2PfdVuG.png)

實際的網路封包則是類似這樣流動  
![](https://i.imgur.com/Tgn7xYX.png)

## KSKB-IX
KSKB-IX 是「虛擬 IXP」，模擬公網的基礎設施
主要使用[隧道和 VM ](/#join)接入，供業餘愛好和體驗測試用  
示意圖可以看到「VM接入」和「隧道接入」分別模擬的部分  

主機硬體是一台規格不高的電腦 (4 core + 16G RAM)，給所有人都開 kvm 記憶體會不夠  
因此 VM 接入的成員，只能提供 LXC VM(1core/512M 記憶體，合理使用禁止佔滿)   
只能夠真的有需要才開 kvm (比如 RouterOS)  
但不管是 KVM 或是 LXC，都能安裝 bird/frr 開轉發，扮演一個路由器的角色  
![](https://i.imgur.com/PPVWC59.png)

虛擬 IXP 並不提供給商業用途使用，也不能長時間跑大流量占用... 
有此需求請接入物理 IXP 或是商業性質的混合 IXP  
若想測試和學習，或是增加 peer 數量，非常歡迎加入喔  